#include "Arduino.h"
#include "Eyes.h"

#define PUISS 40

uint8_t vide[] = {
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0
};

uint8_t eyesstraight[] = {
	0,0,7,7,7,0,0,0,0,7,7,7,0,0,
	0,7,0,0,0,7,0,0,7,0,0,0,7,0,
	0,7,0,2,0,7,0,0,7,0,2,0,7,0,
	0,7,0,0,0,7,0,0,7,0,0,0,7,0,
	0,0,7,7,7,0,0,0,0,7,7,7,0,0
};

uint8_t eyesright[] = {
	0,0,7,7,7,0,0,0,0,7,7,7,0,0,
	0,7,0,0,0,7,0,0,7,0,0,0,7,0,
	0,7,2,0,0,7,0,0,7,2,0,0,7,0,
	0,7,0,0,0,7,0,0,7,0,0,0,7,0,
	0,0,7,7,7,0,0,0,0,7,7,7,0,0
};

uint8_t eyesleft[] = {
	0,0,7,7,7,0,0,0,0,7,7,7,0,0,
	0,7,0,0,0,7,0,0,7,0,0,0,7,0,
	0,7,0,0,2,7,0,0,7,0,0,2,7,0,
	0,7,0,0,0,7,0,0,7,0,0,0,7,0,
	0,0,7,7,7,0,0,0,0,7,7,7,0,0
};


uint8_t eyestop[] = {
	0,0,7,7,7,0,0,0,0,7,7,7,0,0,
	0,7,0,2,0,7,0,0,7,0,2,0,7,0,
	0,7,0,0,0,7,0,0,7,0,0,0,7,0,
	0,7,0,0,0,7,0,0,7,0,0,0,7,0,
	0,0,7,7,7,0,0,0,0,7,7,7,0,0
};

uint8_t eyesbottom[] = {
	0,0,7,7,7,0,0,0,0,7,7,7,0,0,
	0,7,0,0,0,7,0,0,7,0,0,0,7,0,
	0,7,0,0,0,7,0,0,7,0,0,0,7,0,
	0,7,0,2,0,7,0,0,7,0,2,0,7,0,
	0,0,7,7,7,0,0,0,0,7,7,7,0,0
};

uint8_t exclamations[] = {
	0,0,1,0,1,0,1,0,1,0,1,0,0,0,
	0,0,1,0,1,0,1,0,1,0,1,0,0,0,
	0,0,1,0,1,0,1,0,1,0,1,0,0,0,
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,
	0,0,1,0,1,0,1,0,1,0,1,0,0,0
};

uint8_t interogations[] = {
	0,4,4,4,0,4,4,4,0,4,4,4,0,0,
	0,4,0,4,0,4,0,4,0,4,0,4,0,0,
	0,0,4,4,0,0,4,4,0,0,4,4,0,0,
	0,0,4,0,0,0,4,0,0,0,4,0,0,0,
	0,0,2,0,0,0,2,0,0,0,2,0,0,0
};

uint8_t stop[] = {
	1,1,1,0,1,1,1,0,1,1,1,0,1,1,
	1,0,0,0,0,1,0,0,1,0,1,0,1,1,
	1,1,1,0,0,1,0,0,1,0,1,0,1,0,
	0,0,1,0,0,1,0,0,1,0,1,0,1,0,
	1,1,1,0,0,1,0,0,1,1,1,0,1,0
};

uint8_t hello[] = {
	7,0,7,0,2,2,0,1,0,1,0,5,5,5,
	7,0,7,0,2,0,0,1,0,1,0,5,0,5,
	7,7,7,0,2,2,0,1,0,1,0,5,0,5,
	7,0,7,0,2,0,0,1,0,1,0,5,0,5,
	7,0,7,0,2,2,0,1,1,1,1,5,5,5

};

uint8_t error[] = {
	1,1,3,3,3,1,1,1,3,3,3,1,1,1,
	1,0,3,0,3,1,0,1,3,0,3,1,0,1,
	1,1,3,3,3,1,1,1,3,0,3,1,1,1,
	1,0,3,3,0,1,1,0,3,0,3,1,1,0,
	1,1,3,0,3,1,0,1,3,3,3,1,0,1
};


uint8_t *tabeyes[] = {
	vide,
	eyesstraight,
	eyesright,
	eyesleft,
	eyestop,
	eyesbottom,
	exclamations,
	interogations,
	stop,
	hello,
	error
};

Eyes::Eyes(int pin)
{
	pixels = new Adafruit_NeoPixel(NUMPIXELS, pin, NEO_GRB + NEO_KHZ800);
}

Eyes::~Eyes()
{
	delete pixels;
}


void Eyes::begin()
{
	pixels->begin();
}

int Eyes::display_void()
{
	for (int i = 0 ; i < NUMPIXELS ; i++) {
		pixels->setPixelColor(i, pixels->Color(0, 0, 0));
		pixels->show();
	}

	return EYESVIDE;
}

int Eyes::setMatrice(uint8_t *mat)
{

	int id = 0;
	int mir = 0;

	for (int i = 0 ; i < NUMPIXELS ; i++) {
		int ligne = i / LINEWIDTH;
		if (ligne % 2 == 0) {
			id = i;
		} else {
			int col = LINEWIDTH - (i % LINEWIDTH) - 1;
			id = ligne * LINEWIDTH + col;
		}

		uint32_t color = pixels->Color(((mat[i] & 1) == 1 ? PUISS : 0),
					       ((mat[i] & 2) == 2 ? PUISS : 0),
					       ((mat[i] & 4) == 4 ? PUISS : 0));
		pixels->setPixelColor(id, color);
	}

	pixels->show();

}

int Eyes::setMatrice(int id)
{
	setMatrice(tabeyes[id]);
	return id;
}


int Eyes::display_stop()
{
	setMatrice(stop);
	return EYESSTOP;
}
